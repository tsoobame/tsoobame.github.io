<!DOCTYPE html><html lang="en" style="height:100%"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Decomplecting shape and optionality</title><meta name="next-head-count" content="3"/><link rel="stylesheet" href="https://unpkg.com/prism-themes@1.9.0/themes/prism-vsc-dark-plus.min.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-Z67DVHFVCM"></script><script async="" src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.0/mermaid.min.js"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-Z67DVHFVCM', {
              page_path: window.location.pathname,
            });
          </script><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-fc37f78f7b08c779.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-e5e3028d01be4a56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-2da26c76ee71effa.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/08d5973c-93551e6c2b860ae6.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/181-06ac36073c0625e7.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/672-6fb3b021c17f5fb2.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-a3dc28cc2acd48c8.js" defer="" crossorigin=""></script><script src="/_next/static/otESvGl4OI2fDtGK8bZWs/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/otESvGl4OI2fDtGK8bZWs/_ssgManifest.js" defer="" crossorigin=""></script><style id="jss-server-side">.jss1 {
  background: linear-gradient(90deg, #00766c, #0077c2);
}
.jss3 {
  overflow-x: auto;
  justify-content: space-between;
}
.jss4 {
  padding: 8px;
  flex-shrink: 0;
}
.jss5 {
  top: 0;
  left: 0;
  right: 0;
  width: 100%;
  z-index: 1;
  position: fixed;
}
.jss6 {
  color: #FFFFFF;
  width: 100%;
  bottom: 0;
  padding: 16px 0px;
  z-index: 99;
  position: fixed;
  background: linear-gradient(90deg, #00766c, #0077c2);
}</style></head><body style="padding:0;margin:0;min-height:100%"><div id="__next"><style data-emotion="css 1a51u83">.css-1a51u83{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;background-color:#26a69a;color:#FFFFFF;}</style><style data-emotion="css 1rhdqfh">.css-1rhdqfh{background-color:#FFFFFF;color:#263238;-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;background-color:#26a69a;color:#FFFFFF;}</style><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic jss5 css-1rhdqfh" style="padding:0"><style data-emotion="css i6s8oy">.css-i6s8oy{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;}@media (min-width:600px){.css-i6s8oy{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.css-i6s8oy{min-height:48px;}}}@media (min-width:600px){.css-i6s8oy{min-height:64px;}}</style><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular jss1 css-i6s8oy"><style data-emotion="css 18zcnv2">.css-18zcnv2{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1.5rem;line-height:1.334;letter-spacing:0em;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:inherit;}</style><h2 class="MuiTypography-root MuiTypography-h5 MuiTypography-alignCenter MuiTypography-noWrap jss2 css-18zcnv2"><a color="inherit" href="/" style="color:white;text-decoration:none">tsoobame</a></h2><style data-emotion="css i9gxme">.css-i9gxme{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="MuiBox-root css-i9gxme"><style data-emotion="css 4fvm0a">.css-4fvm0a{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#26a69a;color:#FFFFFF;}.css-4fvm0a:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(38, 166, 154, 0.04);}@media (hover: none){.css-4fvm0a:hover{background-color:transparent;}}.css-4fvm0a.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css ye6gas">.css-ye6gas{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#26a69a;color:#FFFFFF;}.css-ye6gas::-moz-focus-inner{border-style:none;}.css-ye6gas.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-ye6gas{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-ye6gas:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(38, 166, 154, 0.04);}@media (hover: none){.css-ye6gas:hover{background-color:transparent;}}.css-ye6gas.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary css-ye6gas" tabindex="0" type="button"><a href="/blog" color="inherit" style="color:white;text-decoration:none">Blog</a></button><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary css-ye6gas" tabindex="0" type="button"><a href="/about" color="inherit" style="color:white;text-decoration:none">About</a></button><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary css-ye6gas" tabindex="0" type="button"><a href="/projects" color="inherit" style="color:white;text-decoration:none">Projects</a></button><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary css-ye6gas" tabindex="0" type="button"><a href="/recommended-resources" color="inherit" style="color:white;text-decoration:none">Resources</a></button></div></div></header><div class="MuiBox-root css-0" style="position:relative;width:90%;padding-left:24px;padding-right:24px;margin-top:80px;padding-bottom:90px;z-index:0;min-height:100%"><div class="MuiBox-root css-0" style="width:auto;padding:12px"><style data-emotion="css 15bqboc">.css-15bqboc{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;width:100%;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="MuiGrid-root MuiGrid-container css-15bqboc"><style data-emotion="css 13ps8n2">.css-13ps8n2{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}@media (min-width:600px){.css-13ps8n2{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}@media (min-width:900px){.css-13ps8n2{-webkit-flex-basis:25%;-ms-flex-preferred-size:25%;flex-basis:25%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:25%;}}@media (min-width:1200px){.css-13ps8n2{-webkit-flex-basis:25%;-ms-flex-preferred-size:25%;flex-basis:25%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:25%;}}@media (min-width:1536px){.css-13ps8n2{-webkit-flex-basis:25%;-ms-flex-preferred-size:25%;flex-basis:25%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:25%;}}</style><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-sm-12 MuiGrid-grid-md-3 css-13ps8n2" style="padding:6px"><div><style data-emotion="css t1nuxs">.css-t1nuxs{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1.5rem;line-height:1.334;letter-spacing:0em;margin-bottom:0.35em;}</style><h5 class="MuiTypography-root MuiTypography-h5 MuiTypography-gutterBottom css-t1nuxs">Posts </h5><ul style="list-style-type:none"><li><style data-emotion="css 9l3uo3">.css-9l3uo3{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;}</style><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/data-loader.html" style="text-decoration:none;color:gray">Understanding data loader</a></p></li><li><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/graphql-schema-stitching.html" style="text-decoration:none;color:gray">Graphql Schema Stitching</a></p></li><li><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/shape-vs-optionality.html" style="text-decoration:none;color:gray">Decomplecting shape and optionality</a></p></li><li><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/docker-registry-mirror.html" style="text-decoration:none;color:gray">Local docker registry mirror</a></p></li><li><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/function-call-cascading.html" style="text-decoration:none;color:gray">Function call cascading considered harmful</a></p></li><li><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/talk-think-code.html" style="text-decoration:none;color:gray">Talk, think, code</a></p></li></ul></div></div><style data-emotion="css 1xd5sck">.css-1xd5sck{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}@media (min-width:600px){.css-1xd5sck{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}@media (min-width:900px){.css-1xd5sck{-webkit-flex-basis:75%;-ms-flex-preferred-size:75%;flex-basis:75%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:75%;}}@media (min-width:1200px){.css-1xd5sck{-webkit-flex-basis:75%;-ms-flex-preferred-size:75%;flex-basis:75%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:75%;}}@media (min-width:1536px){.css-1xd5sck{-webkit-flex-basis:75%;-ms-flex-preferred-size:75%;flex-basis:75%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:75%;}}</style><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 MuiGrid-grid-md-9 css-1xd5sck"><img src="https://res.cloudinary.com/ddkok43g3/image/upload/t_Banner 16:9/v1711551544/shape-vs-optionality.jpg" alt="Decomplecting shape and optionality" width="100%"/><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3">⏱ <!-- -->4 min read</p><div class="MuiBox-root css-0"><style data-emotion="css 6s8q25">.css-6s8q25{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:3rem;line-height:1.167;letter-spacing:0em;margin-bottom:0.35em;}</style><h3 class="MuiTypography-root MuiTypography-h3 MuiTypography-gutterBottom css-6s8q25" style="margin-top:24px">Decomplecting shape and optionality</h3>
<style data-emotion="css gtvj52">.css-gtvj52{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2.125rem;line-height:1.235;letter-spacing:0.00735em;margin-bottom:0.35em;}</style><h4 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom css-gtvj52" style="margin-top:24px">TLDR;</h4>
<style data-emotion="css wje1bd">.css-wje1bd{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;margin-bottom:16px;}</style><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">Defining a schema for a given entity we tend to define what attributes this entity has, what types or invariants
each of those attributes have and what attributes are required or optional.</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">In this post I am exposing that the shape of the data (attributes and their types) need to be discussed separately
from their optionality. The optionality does not belong to the entity but to the operation being executed.
If we discuss and define both concepts together as part of the Entity we are complecting two concepts that should we separate
them, the simplicity, clarity and reusability of our system will be greatly improved.</p>
<h4 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom css-gtvj52" style="margin-top:24px">Introduction</h4>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">Apart from my own experience some of the concepts described in this post are also described by well-known
engineers like Rich Hickey in <a href="https://www.youtube.com/watch?v=YR5WdGrpoug">Maybe Not</a> available in my <a href="/recommended-resources">recommended resources</a></p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">I will use a Blog Post as the example for the model but the concepts in this post can be applied to any entity and discussion we can think of.</p>
<h4 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom css-gtvj52" style="margin-top:24px">Defining a blog Post</h4>
<h5 class="MuiTypography-root MuiTypography-h5 MuiTypography-gutterBottom css-t1nuxs" style="margin-top:24px">Defining the shape</h5>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">We need to define the data model of a Post that will be used in a blog (any blog).
After some meetings we agree that we need the following fields:</p>
<div class="remark-highlight"><pre class="language-text"><code class="language-text">- ID: uuid that will identiy the post uniquely
- Title: short text to be shown in links and use as slug
- Body: text where the post will be written to
- Tags: list of keywords to find similar posts
- PublishedAt: datetime when the post was published</code></pre></div>
<h5 class="MuiTypography-root MuiTypography-h5 MuiTypography-gutterBottom css-t1nuxs" style="margin-top:24px">Defining the optionality</h5>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">Once we agree on the shape of the Post entity, we start a new discussion:</p>
<p class="MuiTypography-root MuiTypography-body1 css-9l3uo3" style="padding-left:24px;font-size:1.2em;margin:24px;color:#33%;font-style:italic">What fields are required and what are optional?</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">It seems like all are required since we would need to show all of them in the blog. So we move on
and decide that we will make all columns NOT NULL in the DB.</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">After some time discussing, a junior developer asks:</p>
<p class="MuiTypography-root MuiTypography-body1 css-9l3uo3" style="padding-left:24px;font-size:1.2em;margin:24px;color:#33%;font-style:italic">What about drafts?</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">Another discussion starts about &quot;What is a draft?&quot;. Should a draft have the same shape as the Post but with &quot;nullable&quot;
fields? what are the required fields in this case?</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">After some time discussing the team decided to have 2 very similar tables one with drafts where columns (except id) are NULLABLE and
posts where all columns are required.</p>
<h5 class="MuiTypography-root MuiTypography-h5 MuiTypography-gutterBottom css-t1nuxs" style="margin-top:24px">Consequences</h5>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">There are two entities that somehow are too closely related.
This lead to some problems:</p>
<ul>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">⛔ Entity proliferation. We have all been in projects with too many entities that seem to describe almost the same thing.</p></li>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">⛔ Change management: New fields in Posts will require new fields in Drafts almost always.</p></li>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">⛔ Event ambiguity: If we use EDA or similar, are Drafts / Posts events sent to the same topic? are they really different?
how can we see the history of a Post if it starts as a Draft?</p></li>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">✅ DB leverage: we can use DB schemas to control whether the data being stored is correct or not.</p></li>
</ul>
<h4 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom css-gtvj52" style="margin-top:24px">Rolling back</h4>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">Defining the shape of the entity is something we cannot avoid (or if we can we should not). Having
a clear description of what an Entity is, and what parts form it is desirable specially if the names
and types of the fields are defined by the Domain experts.</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">The problem started when we discussed about the optionality of the fields. When we started discussion:</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">What fields are required and what are optional?</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">The answer to this question should have been another question:</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify"><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3" style="padding-left:24px;font-size:1.2em;margin:24px;color:#33%;font-style:italic">When?</p>
(as engineers we should ask <code>when</code> more often than we do)</p>
<h5 class="MuiTypography-root MuiTypography-h5 MuiTypography-gutterBottom css-t1nuxs" style="margin-top:24px">Optionality per operation</h5>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">What are the operations we can do for/on Posts?
Let&#x27;s say that we can do 3 operations with Posts:</p>
<ul>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">Save the post</p></li>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">Publish the post</p></li>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">Unpublish the post</p></li>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">Delete the post</p></li>
</ul>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">Rules are:</p>
<ul>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">We cannot edit a post if it is published</p></li>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">We cannot delete a post if it is published</p></li>
</ul>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">Optionality has to do with the operation we want to perform on/with a given Envity.
For example, asking:</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">What are the required fields when publishing a post?</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">The conclusion would be very similar to the <a href="#defining-the-optionality">previous discusion</a>.</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">But if we discussed about what are the required field when saving a Post then the answer will be something around: None.</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">We can let users save the posts in whatever state they are (missing tags, missing body, etc)</p>
<h5 class="MuiTypography-root MuiTypography-h5 MuiTypography-gutterBottom css-t1nuxs" style="margin-top:24px">Consequences</h5>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">There is only one entity that goes through different states until it is published.
The benefits are:</p>
<ul>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">✅ Entity proliferation: so far under control.</p></li>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">✅ Change management: there is only one entity we need to think about.</p></li>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">✅ Event unambiguity: all events belong to the same entity so we have one topic and one history line.</p></li>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">⛔ DB leverage: DB Schema cannot be leveraged to control required fields/columns. The control is in the application layer.</p></li>
</ul>
<h4 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom css-gtvj52" style="margin-top:24px">Appendix</h4>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">If we changed the rules and we allowed to edit a post while it is published when discussing the optionality during the <code>save</code> operation
we would need to ask <code>When</code> again.
When the post is already published the requirements will be different than when the post is not published yet (or was unpublished).</p></div></div></div></div></div><footer class="jss6"><style data-emotion="css 1qsxih2">.css-1qsxih2{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1qsxih2{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-1qsxih2{max-width:1200px;}}</style><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><style data-emotion="css 1is0dyx">.css-1is0dyx{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;text-align:center;color:inherit;}</style><p class="MuiTypography-root MuiTypography-body2 MuiTypography-alignCenter css-1is0dyx">Copyright © <!-- -->tonitienda <!-- -->2024<!-- -->.</p></div></footer></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"post":{"title":"Decomplecting shape and optionality","date":"2022-08-28","description":"Separation between the shape of an entity and the optionality of its fields as a way of improving reusability and simplicity.","thumbnail":{"url":"shape-vs-optionality.jpg","attribution":{"name":"Alfons Morales","url":"https://unsplash.com/@alfonsmc10?utm_source=unsplash\u0026utm_medium=referral\u0026utm_content=creditCopyText"}},"tags":["schemas","simplicity","information"],"series":{"name":"Schemas","order":1},"filePath":"shape-vs-optionality.mdx","slug":"shape-vs-optionality","mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    h2: \"h2\",\n    p: \"p\",\n    a: \"a\",\n    h3: \"h3\",\n    div: \"div\",\n    pre: \"pre\",\n    code: \"code\",\n    ul: \"ul\",\n    li: \"li\"\n  }, _provideComponents(), props.components), {Quote} = _components;\n  if (!Quote) _missingMdxReference(\"Quote\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h1, {\n      children: \"Decomplecting shape and optionality\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"TLDR;\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Defining a schema for a given entity we tend to define what attributes this entity has, what types or invariants\\neach of those attributes have and what attributes are required or optional.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In this post I am exposing that the shape of the data (attributes and their types) need to be discussed separately\\nfrom their optionality. The optionality does not belong to the entity but to the operation being executed.\\nIf we discuss and define both concepts together as part of the Entity we are complecting two concepts that should we separate\\nthem, the simplicity, clarity and reusability of our system will be greatly improved.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Introduction\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Apart from my own experience some of the concepts described in this post are also described by well-known\\nengineers like Rich Hickey in \", _jsx(_components.a, {\n        href: \"https://www.youtube.com/watch?v=YR5WdGrpoug\",\n        children: \"Maybe Not\"\n      }), \" available in my \", _jsx(_components.a, {\n        href: \"/recommended-resources\",\n        children: \"recommended resources\"\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I will use a Blog Post as the example for the model but the concepts in this post can be applied to any entity and discussion we can think of.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Defining a blog Post\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Defining the shape\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We need to define the data model of a Post that will be used in a blog (any blog).\\nAfter some meetings we agree that we need the following fields:\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-text\",\n        children: _jsx(_components.code, {\n          className: \"language-text\",\n          children: \"- ID: uuid that will identiy the post uniquely\\n- Title: short text to be shown in links and use as slug\\n- Body: text where the post will be written to\\n- Tags: list of keywords to find similar posts\\n- PublishedAt: datetime when the post was published\"\n        })\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Defining the optionality\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Once we agree on the shape of the Post entity, we start a new discussion:\"\n    }), \"\\n\", _jsx(Quote, {\n      children: \"What fields are required and what are optional?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"It seems like all are required since we would need to show all of them in the blog. So we move on\\nand decide that we will make all columns NOT NULL in the DB.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"After some time discussing, a junior developer asks:\"\n    }), \"\\n\", _jsx(Quote, {\n      children: \"What about drafts?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Another discussion starts about \\\"What is a draft?\\\". Should a draft have the same shape as the Post but with \\\"nullable\\\"\\nfields? what are the required fields in this case?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"After some time discussing the team decided to have 2 very similar tables one with drafts where columns (except id) are NULLABLE and\\nposts where all columns are required.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Consequences\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"There are two entities that somehow are too closely related.\\nThis lead to some problems:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"⛔ Entity proliferation. We have all been in projects with too many entities that seem to describe almost the same thing.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"⛔ Change management: New fields in Posts will require new fields in Drafts almost always.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"⛔ Event ambiguity: If we use EDA or similar, are Drafts / Posts events sent to the same topic? are they really different?\\nhow can we see the history of a Post if it starts as a Draft?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"✅ DB leverage: we can use DB schemas to control whether the data being stored is correct or not.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Rolling back\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Defining the shape of the entity is something we cannot avoid (or if we can we should not). Having\\na clear description of what an Entity is, and what parts form it is desirable specially if the names\\nand types of the fields are defined by the Domain experts.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The problem started when we discussed about the optionality of the fields. When we started discussion:\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"What fields are required and what are optional?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The answer to this question should have been another question:\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(Quote, {\n        children: \"When?\"\n      }), \"\\n(as engineers we should ask \", _jsx(_components.code, {\n        children: \"when\"\n      }), \" more often than we do)\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Optionality per operation\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"What are the operations we can do for/on Posts?\\nLet's say that we can do 3 operations with Posts:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Save the post\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Publish the post\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Unpublish the post\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Delete the post\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Rules are:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"We cannot edit a post if it is published\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"We cannot delete a post if it is published\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Optionality has to do with the operation we want to perform on/with a given Envity.\\nFor example, asking:\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"What are the required fields when publishing a post?\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The conclusion would be very similar to the \", _jsx(_components.a, {\n        href: \"#defining-the-optionality\",\n        children: \"previous discusion\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"But if we discussed about what are the required field when saving a Post then the answer will be something around: None.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We can let users save the posts in whatever state they are (missing tags, missing body, etc)\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Consequences\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"There is only one entity that goes through different states until it is published.\\nThe benefits are:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"✅ Entity proliferation: so far under control.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"✅ Change management: there is only one entity we need to think about.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"✅ Event unambiguity: all events belong to the same entity so we have one topic and one history line.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"⛔ DB leverage: DB Schema cannot be leveraged to control required fields/columns. The control is in the application layer.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Appendix\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If we changed the rules and we allowed to edit a post while it is published when discussing the optionality during the \", _jsx(_components.code, {\n        children: \"save\"\n      }), \" operation\\nwe would need to ask \", _jsx(_components.code, {\n        children: \"When\"\n      }), \" again.\\nWhen the post is already published the requirements will be different than when the post is not published yet (or was unpublished).\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}},"markdown":"# Decomplecting shape and optionality\n\n## TLDR;\n\nDefining a schema for a given entity we tend to define what attributes this entity has, what types or invariants\neach of those attributes have and what attributes are required or optional.\n\nIn this post I am exposing that the shape of the data (attributes and their types) need to be discussed separately\nfrom their optionality. The optionality does not belong to the entity but to the operation being executed.\nIf we discuss and define both concepts together as part of the Entity we are complecting two concepts that should we separate\nthem, the simplicity, clarity and reusability of our system will be greatly improved.\n\n## Introduction\n\nApart from my own experience some of the concepts described in this post are also described by well-known\nengineers like Rich Hickey in [Maybe Not](https://www.youtube.com/watch?v=YR5WdGrpoug) available in my [recommended resources](/recommended-resources)\n\nI will use a Blog Post as the example for the model but the concepts in this post can be applied to any entity and discussion we can think of.\n\n## Defining a blog Post\n\n### Defining the shape\n\nWe need to define the data model of a Post that will be used in a blog (any blog).\nAfter some meetings we agree that we need the following fields:\n\n```text\n- ID: uuid that will identiy the post uniquely\n- Title: short text to be shown in links and use as slug\n- Body: text where the post will be written to\n- Tags: list of keywords to find similar posts\n- PublishedAt: datetime when the post was published\n```\n\n### Defining the optionality\n\nOnce we agree on the shape of the Post entity, we start a new discussion:\n\n\u003cQuote\u003eWhat fields are required and what are optional?\u003c/Quote\u003e\n\nIt seems like all are required since we would need to show all of them in the blog. So we move on\nand decide that we will make all columns NOT NULL in the DB.\n\nAfter some time discussing, a junior developer asks:\n\n\u003cQuote\u003eWhat about drafts?\u003c/Quote\u003e\n\nAnother discussion starts about \"What is a draft?\". Should a draft have the same shape as the Post but with \"nullable\"\nfields? what are the required fields in this case?\n\nAfter some time discussing the team decided to have 2 very similar tables one with drafts where columns (except id) are NULLABLE and\nposts where all columns are required.\n\n### Consequences\n\nThere are two entities that somehow are too closely related.\nThis lead to some problems:\n\n- ⛔ Entity proliferation. We have all been in projects with too many entities that seem to describe almost the same thing.\n- ⛔ Change management: New fields in Posts will require new fields in Drafts almost always.\n- ⛔ Event ambiguity: If we use EDA or similar, are Drafts / Posts events sent to the same topic? are they really different?\n  how can we see the history of a Post if it starts as a Draft?\n- ✅ DB leverage: we can use DB schemas to control whether the data being stored is correct or not.\n\n## Rolling back\n\nDefining the shape of the entity is something we cannot avoid (or if we can we should not). Having\na clear description of what an Entity is, and what parts form it is desirable specially if the names\nand types of the fields are defined by the Domain experts.\n\nThe problem started when we discussed about the optionality of the fields. When we started discussion:\n\nWhat fields are required and what are optional?\n\nThe answer to this question should have been another question:\n\n\u003cQuote\u003eWhen?\u003c/Quote\u003e\n(as engineers we should ask `when` more often than we do)\n\n### Optionality per operation\n\nWhat are the operations we can do for/on Posts?\nLet's say that we can do 3 operations with Posts:\n\n- Save the post\n- Publish the post\n- Unpublish the post\n- Delete the post\n\nRules are:\n\n- We cannot edit a post if it is published\n- We cannot delete a post if it is published\n\nOptionality has to do with the operation we want to perform on/with a given Envity.\nFor example, asking:\n\nWhat are the required fields when publishing a post?\n\nThe conclusion would be very similar to the [previous discusion](#defining-the-optionality).\n\nBut if we discussed about what are the required field when saving a Post then the answer will be something around: None.\n\nWe can let users save the posts in whatever state they are (missing tags, missing body, etc)\n\n### Consequences\n\nThere is only one entity that goes through different states until it is published.\nThe benefits are:\n\n- ✅ Entity proliferation: so far under control.\n- ✅ Change management: there is only one entity we need to think about.\n- ✅ Event unambiguity: all events belong to the same entity so we have one topic and one history line.\n- ⛔ DB leverage: DB Schema cannot be leveraged to control required fields/columns. The control is in the application layer.\n\n## Appendix\n\nIf we changed the rules and we allowed to edit a post while it is published when discussing the optionality during the `save` operation\nwe would need to ask `When` again.\nWhen the post is already published the requirements will be different than when the post is not published yet (or was unpublished).\n"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"shape-vs-optionality"},"buildId":"otESvGl4OI2fDtGK8bZWs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>