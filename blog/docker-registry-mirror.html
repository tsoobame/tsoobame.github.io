<!DOCTYPE html><html lang="en" style="height:100%"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tsoobame - <!-- -->Local docker registry mirror</title><meta name="next-head-count" content="3"/><link rel="stylesheet" href="https://unpkg.com/prism-themes@1.9.0/themes/prism-vsc-dark-plus.min.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-Z67DVHFVCM"></script><script async="" src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.0/mermaid.min.js"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-Z67DVHFVCM', {
              page_path: window.location.pathname,
            });
          </script><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-fc37f78f7b08c779.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-e5e3028d01be4a56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-2da26c76ee71effa.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/08d5973c-93551e6c2b860ae6.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/181-06ac36073c0625e7.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/305-8ed0c2a4f9101866.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-2d9450e354bedcb4.js" defer="" crossorigin=""></script><script src="/_next/static/-Elyrji2CBgz9PLt6Ubsz/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/-Elyrji2CBgz9PLt6Ubsz/_ssgManifest.js" defer="" crossorigin=""></script><style id="jss-server-side">.jss1 {
  background: linear-gradient(90deg, #00766c, #0077c2);
}
.jss3 {
  overflow-x: auto;
  justify-content: space-between;
}
.jss4 {
  padding: 8px;
  flex-shrink: 0;
}
.jss5 {
  top: 0;
  left: 0;
  right: 0;
  width: 100%;
  z-index: 1;
  position: fixed;
}
.jss6 {
  color: #FFFFFF;
  width: 100%;
  bottom: 0;
  padding: 16px 0px;
  z-index: 99;
  position: fixed;
  background: linear-gradient(90deg, #00766c, #0077c2);
}</style></head><body style="padding:0;margin:0;min-height:100%"><div id="__next"><style data-emotion="css 1a51u83">.css-1a51u83{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;background-color:#26a69a;color:#FFFFFF;}</style><style data-emotion="css 1rhdqfh">.css-1rhdqfh{background-color:#FFFFFF;color:#263238;-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;background-color:#26a69a;color:#FFFFFF;}</style><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic jss5 css-1rhdqfh" style="padding:0"><style data-emotion="css i6s8oy">.css-i6s8oy{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;}@media (min-width:600px){.css-i6s8oy{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.css-i6s8oy{min-height:48px;}}}@media (min-width:600px){.css-i6s8oy{min-height:64px;}}</style><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular jss1 css-i6s8oy"><style data-emotion="css 18zcnv2">.css-18zcnv2{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1.5rem;line-height:1.334;letter-spacing:0em;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:inherit;}</style><h2 class="MuiTypography-root MuiTypography-h5 MuiTypography-alignCenter MuiTypography-noWrap jss2 css-18zcnv2"><a color="inherit" href="/" style="color:white;text-decoration:none">tsoobame</a></h2><style data-emotion="css i9gxme">.css-i9gxme{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="MuiBox-root css-i9gxme"><style data-emotion="css 4fvm0a">.css-4fvm0a{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#26a69a;color:#FFFFFF;}.css-4fvm0a:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(38, 166, 154, 0.04);}@media (hover: none){.css-4fvm0a:hover{background-color:transparent;}}.css-4fvm0a.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css ye6gas">.css-ye6gas{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#26a69a;color:#FFFFFF;}.css-ye6gas::-moz-focus-inner{border-style:none;}.css-ye6gas.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-ye6gas{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-ye6gas:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(38, 166, 154, 0.04);}@media (hover: none){.css-ye6gas:hover{background-color:transparent;}}.css-ye6gas.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary css-ye6gas" tabindex="0" type="button"><a href="/blog" color="inherit" style="color:white;text-decoration:none">Blog</a></button><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary css-ye6gas" tabindex="0" type="button"><a href="/about" color="inherit" style="color:white;text-decoration:none">About</a></button><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary css-ye6gas" tabindex="0" type="button"><a href="/projects" color="inherit" style="color:white;text-decoration:none">Projects</a></button><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary css-ye6gas" tabindex="0" type="button"><a href="/recommended-resources" color="inherit" style="color:white;text-decoration:none">Resources</a></button></div></div></header><div class="MuiBox-root css-0" style="position:relative;width:90%;padding-left:24px;padding-right:24px;margin-top:80px;padding-bottom:90px;z-index:0;min-height:100%"><div class="MuiBox-root css-0" style="width:auto;padding:6px"><style data-emotion="css 15bqboc">.css-15bqboc{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;width:100%;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="MuiGrid-root MuiGrid-container css-15bqboc"><style data-emotion="css 13ps8n2">.css-13ps8n2{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}@media (min-width:600px){.css-13ps8n2{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}@media (min-width:900px){.css-13ps8n2{-webkit-flex-basis:25%;-ms-flex-preferred-size:25%;flex-basis:25%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:25%;}}@media (min-width:1200px){.css-13ps8n2{-webkit-flex-basis:25%;-ms-flex-preferred-size:25%;flex-basis:25%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:25%;}}@media (min-width:1536px){.css-13ps8n2{-webkit-flex-basis:25%;-ms-flex-preferred-size:25%;flex-basis:25%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:25%;}}</style><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-sm-12 MuiGrid-grid-md-3 css-13ps8n2" style="padding:6px"><div><style data-emotion="css t1nuxs">.css-t1nuxs{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1.5rem;line-height:1.334;letter-spacing:0em;margin-bottom:0.35em;}</style><h5 class="MuiTypography-root MuiTypography-h5 MuiTypography-gutterBottom css-t1nuxs">Posts </h5><ul style="list-style-type:none"><li><style data-emotion="css 9l3uo3">.css-9l3uo3{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;}</style><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/resume-driven-development.html" style="text-decoration:none;color:gray">Resume Driven Development</a></p></li><li><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/talk-think-code.html" style="text-decoration:none;color:gray">Talk, think, code</a></p></li><li><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/function-call-cascading.html" style="text-decoration:none;color:gray">Function call cascading considered harmful</a></p></li><li><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/docker-registry-mirror.html" style="text-decoration:none;color:gray">Local docker registry mirror</a></p></li><li><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/shape-vs-optionality.html" style="text-decoration:none;color:gray">Decomplecting shape and optionality</a></p></li><li><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/data-loader.html" style="text-decoration:none;color:gray">Understanding data loader</a></p></li><li><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3"><a href="/blog/graphql-schema-stitching.html" style="text-decoration:none;color:gray">Graphql Schema Stitching</a></p></li></ul></div></div><style data-emotion="css 1xd5sck">.css-1xd5sck{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}@media (min-width:600px){.css-1xd5sck{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}@media (min-width:900px){.css-1xd5sck{-webkit-flex-basis:75%;-ms-flex-preferred-size:75%;flex-basis:75%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:75%;}}@media (min-width:1200px){.css-1xd5sck{-webkit-flex-basis:75%;-ms-flex-preferred-size:75%;flex-basis:75%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:75%;}}@media (min-width:1536px){.css-1xd5sck{-webkit-flex-basis:75%;-ms-flex-preferred-size:75%;flex-basis:75%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:75%;}}</style><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 MuiGrid-grid-md-9 css-1xd5sck"><img src="https://res.cloudinary.com/ddkok43g3/image/upload/t_Banner 16:9/v1711551544/docker-registry-mirror.jpg" alt="Local docker registry mirror" width="100%"/><style data-emotion="css 1anx036">.css-1anx036{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:1.25rem;line-height:1.6;letter-spacing:0.0075em;}</style><h6 class="MuiTypography-root MuiTypography-h6 css-1anx036">2022-09-05</h6><p class="MuiTypography-root MuiTypography-body1 css-9l3uo3">⏱ <!-- -->2 min read</p><div class="MuiBox-root css-0"><style data-emotion="css 6s8q25">.css-6s8q25{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:3rem;line-height:1.167;letter-spacing:0em;margin-bottom:0.35em;}</style><h3 class="MuiTypography-root MuiTypography-h3 MuiTypography-gutterBottom css-6s8q25" style="margin-top:24px">Docker Registry Local Mirror</h3>
<style data-emotion="css gtvj52">.css-gtvj52{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2.125rem;line-height:1.235;letter-spacing:0.00735em;margin-bottom:0.35em;}</style><h4 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom css-gtvj52" style="margin-top:24px">Why I needed it</h4>
<style data-emotion="css wje1bd">.css-wje1bd{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;margin-bottom:16px;}</style><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">I recently started working on some personal projects to do and learn things that I had in my TODO list for a very long time.
One the moments when I work on it is during my (long) commuting times when I go to the office or somewhere else by train.
In order to get my docker images I need internet connection provided by my phone and it brings a couple of problems:</p>
<ul>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">I don&#x27;t have a large amount of GB per month so I am exhausting my available data pretty soon.</p></li>
<li><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify;margin-bottom:3px">When I am in tunnels, etc. the connection is dropped.</p></li>
</ul>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">When docker images are new, there is no way to escape it, but I usually use the same docker images for the same projects. Once they
are downloaded there is no problem but I like keeping the amount of images in my system under control, so I want to be able to do:</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> rmi <span class="token parameter variable">-f</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images <span class="token parameter variable">-aq</span><span class="token variable">)</span></span>
</code></pre></div>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">often.</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">I thought that if would be cool to have a mirror of the docker registry with the images I use so I can keep running this command and <code>pull</code> the images
from my computer.</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">That&#x27;s why I decided to try out and add a docker registri mirror in my machine. And it turned out much easier than I expected.</p>
<h4 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom css-gtvj52" style="margin-top:24px">How it works</h4>
<div style="display:none"><mermaid chart="sequenceDiagram

actor me
participant DockerDaemon
participant RegistryMirror
participant DockerRegistry


me -&gt;&gt;+ DockerDaemon: docker-compose(up)
DockerDaemon -&gt;&gt; RegistryMirror: start
DockerDaemon --&gt;&gt;- me: ok

rect rgb(200,230,250)
    note right of me: Online / First pull

    me -&gt;&gt;+ DockerDaemon: pull(ubuntu)
    DockerDaemon -&gt;&gt; RegistryMirror: pull(ubuntu)
    RegistryMirror -&gt;&gt; DockerRegistry: pull(ubuntu)
    DockerRegistry --&gt;&gt; RegistryMirror: ubuntu
    RegistryMirror -&gt;&gt; RegistryMirror: store(ubuntu)
    RegistryMirror --&gt;&gt; DockerDaemon: ubuntu
    DockerDaemon --&gt;&gt; me: 
end

rect rgb(200,230,250)
    note right of me: Offline / Second pull

    me -&gt;&gt;+ DockerDaemon: pull(ubuntu)
    DockerDaemon -&gt;&gt; RegistryMirror: pull(ubuntu)
    RegistryMirror --&gt;&gt; DockerDaemon: ubuntu
    DockerDaemon --&gt;&gt; me: 
end

rect rgb(200,230,250)
    note right of me: Offline / First pull

    me -&gt;&gt;+ DockerDaemon: pull(alpine)
    DockerDaemon -&gt;&gt; RegistryMirror: pull(alpine)
    RegistryMirror -x DockerRegistry: pull(alpine)
    RegistryMirror --x DockerDaemon: error
    DockerDaemon --x me: error
end"></mermaid></div>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify"><img src="https://tsoobame.github.io/images/posts/docker-registry-mermaid.png" alt="docker registry sequence diagram"/>
<sub>I did not configure mermaid in my blog yet. I will replace the image with the diagram when it is ready</sub></p>
<h4 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom css-gtvj52" style="margin-top:24px">How can you use it</h4>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">The code and the explanation on how to use it can be found in the <a href="https://github.com/tonitienda/docker-registry-mirror">docker-registry-mirror repository</a>.</p>
<p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-wje1bd" style="text-align:justify">Happy (and low data usage) programming!</p></div></div></div></div></div><footer class="jss6"><style data-emotion="css 1qsxih2">.css-1qsxih2{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1qsxih2{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-1qsxih2{max-width:1200px;}}</style><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><style data-emotion="css 1is0dyx">.css-1is0dyx{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;text-align:center;color:inherit;}</style><p class="MuiTypography-root MuiTypography-body2 MuiTypography-alignCenter css-1is0dyx">Copyright © <!-- -->tonitienda <!-- -->2024<!-- -->.</p></div></footer></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"post":{"title":"Local docker registry mirror","date":"2022-09-05","description":"Why I configured a docker registry in my local machine to improve my development process","thumbnail":{"url":"docker-registry-mirror.jpg","attribution":{"name":"Guillaume Bolduc","url":"https://unsplash.com/@guibolduc"}},"tags":["docker","development","tools"],"filePath":"docker-registry-mirror.mdx","slug":"docker-registry-mirror","mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    h2: \"h2\",\n    p: \"p\",\n    ul: \"ul\",\n    li: \"li\",\n    div: \"div\",\n    pre: \"pre\",\n    code: \"code\",\n    span: \"span\",\n    mermaid: \"mermaid\",\n    img: \"img\",\n    a: \"a\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h1, {\n      children: \"Docker Registry Local Mirror\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Why I needed it\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I recently started working on some personal projects to do and learn things that I had in my TODO list for a very long time.\\nOne the moments when I work on it is during my (long) commuting times when I go to the office or somewhere else by train.\\nIn order to get my docker images I need internet connection provided by my phone and it brings a couple of problems:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"I don't have a large amount of GB per month so I am exhausting my available data pretty soon.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"When I am in tunnels, etc. the connection is dropped.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"When docker images are new, there is no way to escape it, but I usually use the same docker images for the same projects. Once they\\nare downloaded there is no problem but I like keeping the amount of images in my system under control, so I want to be able to do:\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-bash\",\n        children: _jsxs(_components.code, {\n          className: \"language-bash\",\n          children: [_jsx(_components.span, {\n            className: \"token function\",\n            children: \"docker\"\n          }), \" rmi \", _jsx(_components.span, {\n            className: \"token parameter variable\",\n            children: \"-f\"\n          }), \" \", _jsxs(_components.span, {\n            className: \"token variable\",\n            children: [_jsx(_components.span, {\n              className: \"token variable\",\n              children: \"$(\"\n            }), _jsx(_components.span, {\n              className: \"token function\",\n              children: \"docker\"\n            }), \" images \", _jsx(_components.span, {\n              className: \"token parameter variable\",\n              children: \"-aq\"\n            }), _jsx(_components.span, {\n              className: \"token variable\",\n              children: \")\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"often.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"I thought that if would be cool to have a mirror of the docker registry with the images I use so I can keep running this command and \", _jsx(_components.code, {\n        children: \"pull\"\n      }), \" the images\\nfrom my computer.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"That's why I decided to try out and add a docker registri mirror in my machine. And it turned out much easier than I expected.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"How it works\"\n    }), \"\\n\", _jsx(\"div\", {\n      style: {\n        display: \"none\"\n      },\n      children: _jsx(_components.mermaid, {\n        chart: \"sequenceDiagram\\n\\nactor me\\nparticipant DockerDaemon\\nparticipant RegistryMirror\\nparticipant DockerRegistry\\n\\n\\nme -\u003e\u003e+ DockerDaemon: docker-compose(up)\\nDockerDaemon -\u003e\u003e RegistryMirror: start\\nDockerDaemon --\u003e\u003e- me: ok\\n\\nrect rgb(200,230,250)\\n    note right of me: Online / First pull\\n\\n    me -\u003e\u003e+ DockerDaemon: pull(ubuntu)\\n    DockerDaemon -\u003e\u003e RegistryMirror: pull(ubuntu)\\n    RegistryMirror -\u003e\u003e DockerRegistry: pull(ubuntu)\\n    DockerRegistry --\u003e\u003e RegistryMirror: ubuntu\\n    RegistryMirror -\u003e\u003e RegistryMirror: store(ubuntu)\\n    RegistryMirror --\u003e\u003e DockerDaemon: ubuntu\\n    DockerDaemon --\u003e\u003e me: \\nend\\n\\nrect rgb(200,230,250)\\n    note right of me: Offline / Second pull\\n\\n    me -\u003e\u003e+ DockerDaemon: pull(ubuntu)\\n    DockerDaemon -\u003e\u003e RegistryMirror: pull(ubuntu)\\n    RegistryMirror --\u003e\u003e DockerDaemon: ubuntu\\n    DockerDaemon --\u003e\u003e me: \\nend\\n\\nrect rgb(200,230,250)\\n    note right of me: Offline / First pull\\n\\n    me -\u003e\u003e+ DockerDaemon: pull(alpine)\\n    DockerDaemon -\u003e\u003e RegistryMirror: pull(alpine)\\n    RegistryMirror -x DockerRegistry: pull(alpine)\\n    RegistryMirror --x DockerDaemon: error\\n    DockerDaemon --x me: error\\nend\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.img, {\n        src: \"https://tsoobame.github.io/images/posts/docker-registry-mermaid.png\",\n        alt: \"docker registry sequence diagram\"\n      }), \"\\n\", _jsx(\"sub\", {\n        children: \"I did not configure mermaid in my blog yet. I will replace the image with the diagram when it is ready\"\n      })]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"How can you use it\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The code and the explanation on how to use it can be found in the \", _jsx(_components.a, {\n        href: \"https://github.com/tonitienda/docker-registry-mirror\",\n        children: \"docker-registry-mirror repository\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Happy (and low data usage) programming!\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"markdown":"# Docker Registry Local Mirror\n\n## Why I needed it\n\nI recently started working on some personal projects to do and learn things that I had in my TODO list for a very long time.\nOne the moments when I work on it is during my (long) commuting times when I go to the office or somewhere else by train.\nIn order to get my docker images I need internet connection provided by my phone and it brings a couple of problems:\n\n- I don't have a large amount of GB per month so I am exhausting my available data pretty soon.\n- When I am in tunnels, etc. the connection is dropped.\n\nWhen docker images are new, there is no way to escape it, but I usually use the same docker images for the same projects. Once they\nare downloaded there is no problem but I like keeping the amount of images in my system under control, so I want to be able to do:\n\n```bash\ndocker rmi -f $(docker images -aq)\n```\n\noften.\n\nI thought that if would be cool to have a mirror of the docker registry with the images I use so I can keep running this command and `pull` the images\nfrom my computer.\n\nThat's why I decided to try out and add a docker registri mirror in my machine. And it turned out much easier than I expected.\n\n## How it works\n\n\u003cdiv style={{ display: \"none\"}}\u003e\n\n```mermaid\nsequenceDiagram\n\nactor me\nparticipant DockerDaemon\nparticipant RegistryMirror\nparticipant DockerRegistry\n\n\nme -\u003e\u003e+ DockerDaemon: docker-compose(up)\nDockerDaemon -\u003e\u003e RegistryMirror: start\nDockerDaemon --\u003e\u003e- me: ok\n\nrect rgb(200,230,250)\n    note right of me: Online / First pull\n\n    me -\u003e\u003e+ DockerDaemon: pull(ubuntu)\n    DockerDaemon -\u003e\u003e RegistryMirror: pull(ubuntu)\n    RegistryMirror -\u003e\u003e DockerRegistry: pull(ubuntu)\n    DockerRegistry --\u003e\u003e RegistryMirror: ubuntu\n    RegistryMirror -\u003e\u003e RegistryMirror: store(ubuntu)\n    RegistryMirror --\u003e\u003e DockerDaemon: ubuntu\n    DockerDaemon --\u003e\u003e me: \nend\n\nrect rgb(200,230,250)\n    note right of me: Offline / Second pull\n\n    me -\u003e\u003e+ DockerDaemon: pull(ubuntu)\n    DockerDaemon -\u003e\u003e RegistryMirror: pull(ubuntu)\n    RegistryMirror --\u003e\u003e DockerDaemon: ubuntu\n    DockerDaemon --\u003e\u003e me: \nend\n\nrect rgb(200,230,250)\n    note right of me: Offline / First pull\n\n    me -\u003e\u003e+ DockerDaemon: pull(alpine)\n    DockerDaemon -\u003e\u003e RegistryMirror: pull(alpine)\n    RegistryMirror -x DockerRegistry: pull(alpine)\n    RegistryMirror --x DockerDaemon: error\n    DockerDaemon --x me: error\nend\n```\n\u003c/div\u003e\n\n![docker registry sequence diagram](https://tsoobame.github.io/images/posts/docker-registry-mermaid.png)\n\u003csub\u003eI did not configure mermaid in my blog yet. I will replace the image with the diagram when it is ready\u003c/sub\u003e\n\n## How can you use it\n\nThe code and the explanation on how to use it can be found in the [docker-registry-mirror repository](https://github.com/tonitienda/docker-registry-mirror). \n\n\nHappy (and low data usage) programming!"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"docker-registry-mirror"},"buildId":"-Elyrji2CBgz9PLt6Ubsz","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>